<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Debug Event Test</title>
</head>

<body>
    <div id="app">
        <test-comp></test-comp>
    </div>

    <script type="module">
        import { createApp } from './melodijs.js';

        const app = createApp({
            components: {
                'test-comp': {
                    template: `
                        <div>
                            <h1>Event Debug Test</h1>
                            <button @click="testClick">Test Click</button>
                            <p>Clicked: {{ count }}</p>
                            
                            <h2>V-for without key</h2>
                            <ul>
                                <li v-for="item in items">
                                    {{ item.name }}
                                    <button @click="deleteItem(item.id)">Delete</button>
                                </li>
                            </ul>
                            
                            <h2>V-for with key</h2>
                            <ul>
                                <li v-for="item in items2" :key="item.id">
                                    {{ item.name }}
                                    <button @click="deleteItem2(item.id)">Delete</button>
                                </li>
                            </ul>
                        </div>
                    `,
                    data() {
                        return {
                            count: 0,
                            items: [
                                { id: 1, name: 'Item 1' },
                                { id: 2, name: 'Item 2' },
                                { id: 3, name: 'Item 3' }
                            ],
                            items2: [
                                { id: 1, name: 'Item A' },
                                { id: 2, name: 'Item B' },
                                { id: 3, name: 'Item C' }
                            ]
                        };
                    },
                    methods: {
                        testClick() {
                            console.log('testClick called');
                            this.count++;
                        },
                        deleteItem(id) {
                            console.log('deleteItem called with id:', id);
                            const index = this.items.findIndex(item => item.id === id);
                            if (index !== -1) {
                                this.items.splice(index, 1);
                                this.items = [...this.items]; // Trigger reactivity
                            }
                        },
                        deleteItem2(id) {
                            console.log('deleteItem2 called with id:', id);
                            const index = this.items2.findIndex(item => item.id === id);
                            if (index !== -1) {
                                this.items2.splice(index, 1);
                                this.items2 = [...this.items2]; // Trigger reactivity
                            }
                        }
                    }
                }
            }
        });

        app.mount('#app');
        console.log('App mounted');
    </script>
</body>

</html>