<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melodi JS</title>
</head>

<body>
    <h1>Melodi JS</h1>

    <div id="app">

        <parent-demo> <child-demo></child-demo> </parent-demo>

        <v-controls-demo> </v-controls-demo>
        <!-- component using inline template and local state -->
        <my-counter start="3">
            <div slot="footer">
                <my-counter-template start="1"></my-counter-template>
            </div>
            <div slot="header">header</div>

            <h1>c tepl sss</h1>
        </my-counter>

        <!-- component reading template from a <template> element -->
        <my-counter-template start="1"></my-counter-template>

        <!-- component fetching template via URL (served from templates/counter.html) -->
        <h1>c fetched</h1>

        <my-counter-fetch start="10"></my-counter-fetch>

        <!-- components that share a global store -->
        <h1>c global</h1>
        <store-incrementer></store-incrementer>

        <h1>store</h1>
        <store-display></store-display>

        <!-- default slot example -->
        <panel-box>
            <p slot="header">header</p>
            <p>Contenu passé au slot p par défaut du panel.</p>
            <p slot="footer">footer</p>
        </panel-box>

        <!-- named slots example -->
        <panel-named>
            <p>heheh</p>
        </panel-named>
    </div>

    <!-- template element to demonstrate template-from-HTML -->
    <template id="tpl-counter">
        <div class="counter-template">
            <h1>counter</h1>
            <button @click="decrement">-</button>
            <span>{{ count }}</span>
            <button @click="increment">+</button>
            <div v-if="">

            </div>
        </div>
    </template>

    <template id="ddd">
        <div style="border:1px solid #4a90e2;padding:8px;margin:8px 0;">
            <h3>Parent Demo</h3>
            <div>message from child: {{ message }}</div>
            <slot>
            </slot>
        </div>
    </template>

    <script type="module">
        import { createApp } from './melodijs.js'

        const app = createApp({
            store: { sharedCount: 0 },
            components: {
                'my-counter': {
                    template: `
                        <div class="counter">
                            <button @click="decrement">-</button>
                            <span>{{ count }}</span>
                            <button @click="increment">+</button>
                            <div>
                                <input type="number" v-model="count" />
                            </div>
                            <store-display></store-display>
                            <hr>
                        </div>
                    `,
                    data() { return { count: 0 } },
                    methods: {
                        increment() { this.count = Number(this.count) + 1 },
                        decrement() { this.count = Number(this.count) - 1 }
                    }
                },
                'my-counter-template': {
                    template: { el: '#tpl-counter' },
                    props: { start: { type: Number, default: 10 } },
                    data() { console.log('data start (should be Number):', typeof this.start, this.start); return { count: this.start } },
                    hooks: { beforeMount() { }, },
                    methods: { increment() { this.count = Number(this.count) + 1 }, decrement() { this.count = Number(this.count) - 1 } }
                },
                'my-counter-fetch': {
                    template: { url: '/templates/counter.html' },
                    data() { return { count: 0 } },
                    methods: { increment() { this.count = Number(this.count) + 1; this.$store.sharedCount = Number(this.$store.sharedCount || 0) + 2 }, decrement() { this.count = Number(this.count) - 1 } }
                },
                'store-incrementer': {
                    template: `<div><button @click="incStore">inc shared store</button></div>`,
                    data() { return {} },
                    methods: { incStore() { this.$store.sharedCount = Number(this.$store.sharedCount || 0) + 1 } }
                },
                'store-display': {
                    template: `<div>shared store count: {{ $store.sharedCount }}</div>`,
                    data() { return {} },
                    methods: {}
                },
                'panel-box': {
                    template: `
                        <div class="panel" style="border:1px solid #ccc;padding:8px;">
                            <header><strong>Panel header</strong></header>
                            <slot name="header"></slot>
                            <div class="panel-body"><slot></slot></div>
                            <slot name="footer"></slot>
                        </div>
                    `,
                    data() { return {} }
                },
                'panel-named': {
                    template: `
                        <div class="panel" style="border:1px solid #666;padding:8px;margin:8px 0;">
                            <div class="panel-header"><slot name="header">hiiii</slot></div>
                            <div class="panel-body"><slot></slot></div>
                            <div class="panel-footer"><slot name="footer">ohhh</slot></div>
                        </div>
                    `,
                    data() { return {} }
                }
                ,
                // Demo: v-if / v-show / v-for
                'v-controls-demo': {
                    template: `
                        <div style="border:1px dashed #aaa;padding:8px;margin:8px 0;">
                            <h3>v-controls demo</h3>
                            <label><input type="checkbox" v-model="showList" /> show list (v-show)</label>
                            <button @click="toggleHidden">toggle hiddenFlag (v-if)</button>
                            <div v-if="hiddenFlag">This block is shown with v-if when hiddenFlag is false</div>
                            <div v-show="showList">
                                <ul>
                                    <li v-for="(it, idx) in items">{{ idx }} - {{ it }}</li>
                                </ul>
                                <div>
                                    <h4>v-for over object (dict)</h4>
                                    <ul>
                                        <li v-for="(val, key) in tems">{{ key }} -> {{ val.toUpperCase() }} |</li>
                                    </ul>
                                </div>
                                <div >
                                    <h4>v-pre example (raw mustache, not evaluated)</h4>
                                    <div v-pre>{{ 1 + 2 }} should not be evaluated here</div>
                                </div>
                            </div>
                        </div>
                    `,
                    data() { return { items: ['apple', 'banana', 'cherry'], tems: { one: 'gg', two: 'oo' }, showList: true, hiddenFlag: false } },
                    methods: { toggleHidden() { this.hiddenFlag = !this.hiddenFlag } }
                },
                'parent-demo': {
                    template: { el: "#ddd" },
                    data() { return { message: '---' } },
                    hooks: {
                        mounted() {
                            // listen for events emitted by descendants
                            this.$on('child-ping', (payload) => { this.message = payload })
                        }
                    }
                },
                'child-demo': {
                    template: `<div><button @click="ping">Emit to parent</button></div>`,
                    data() { return {} },
                    methods: { ping() { this.$emit('child-ping', 'hello from child @ ' + (new Date()).toLocaleTimeString()) } }
                }
            }
        })

        app.mount('#app').then(() => {
            console.log('MelodiJS mounted')
        })
    </script>
</body>

</html>