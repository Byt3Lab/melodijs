<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick v-for :key Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            color: #667eea;
        }

        button {
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #5568d3;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            padding: 1rem;
            margin: 0.5rem 0;
            background: #f5f5f5;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        input {
            padding: 0.5rem;
        }

        .result {
            margin-top: 1rem;
            padding: 1rem;
            background: #e0ffe0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div id="app">
        <test-component></test-component>
    </div>

    <script type="module">
        import { createApp } from './melodijs.js';

        const app = createApp({
            components: {
                'test-component': {
                    template: `
                        <div>
                            <h1>✅ Test v-for :key</h1>
                            <button @click="addItem">Add Item</button>
                            <button @click="shuffle">Shuffle</button>
                            <button @click="removeFirst">Remove First</button>
                            
                            <h2>With :key (optimized)</h2>
                            <ul>
                                <li v-for="item in items" :key="item.id">
                                    <span>{{ item.id }}: {{ item.name }}</span>
                                    <input type="text" v-model="item.note" placeholder="Type here...">
                                </li>
                            </ul>
                            
                            <div class="result">
                                <strong>Test:</strong> Type in inputs, then shuffle or add items.
                                <br>Expected: Input values stay with their items! ✨
                            </div>
                        </div>
                    `,
                    data() {
                        return {
                            items: [
                                { id: 1, name: 'Alpha', note: '' },
                                { id: 2, name: 'Beta', note: '' },
                                { id: 3, name: 'Gamma', note: '' }
                            ],
                            nextId: 4
                        };
                    },
                    methods: {
                        addItem() {
                            this.items.push({
                                id: this.nextId,
                                name: `Item ${this.nextId}`,
                                note: ''
                            });
                            this.nextId++;
                            this.items = [...this.items]; // Trigger reactivity
                        },
                        shuffle() {
                            const newItems = [...this.items];
                            for (let i = newItems.length - 1; i > 0; i--) {
                                const j = Math.floor(Math.random() * (i + 1));
                                [newItems[i], newItems[j]] = [newItems[j], newItems[i]];
                            }
                            this.items = newItems;
                        },
                        removeFirst() {
                            if (this.items.length > 0) {
                                this.items.shift();
                                this.items = [...this.items]; // Trigger reactivity
                            }
                        }
                    }
                }
            }
        });

        app.mount('#app');

        console.log('✅ v-for :key test loaded successfully!');
        console.log('Try typing in the inputs and then shuffling the list.');
        console.log('The input values should stay with their respective items.');
    </script>
</body>

</html>